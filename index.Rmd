---
title: "NFL Field Goals in 2018 - 2020"
author: "Chloe Nguyen"
output: html_document
---

<style>

body {
  background-image: url('assets/back.jpg');
  background-repeat: no-repeat;
  background-size: 100% 7%;
}

.html-widget {
  margin: auto;
}

h1 {
  text-align: center;
  font-family: "Arial";
  font-weight: 600;
}

h1.title {
    font-size: 0px;
}

h4.author {
    font-size: 0px;
}

h5 {
  text-align: center;
}

.nav-tabs{
  margin-bottom: 5px;
  padding-left: 27%;
}

.marker-cluster-small {
background-color: rgba(218, 169, 183, 0.8);
}
.marker-cluster-small div {
background-color: rgba(192, 108, 132, 0.6);
}
.marker-cluster-medium {
background-color: rgba(174, 161, 186, 0.8);
}
.marker-cluster-medium div {
background-color: rgba(108, 91, 123, 0.6);
}

.marker-cluster-large {
background-color: rgba(162, 190, 215, 0.8);
}
.marker-cluster-large div {
background-color: rgba(53, 92, 125, 0.6);
}

</style>



```{r, echo=FALSE, out.width = '100%', class.source='landing'}
knitr::include_graphics("assets/landing.jpg")
```

<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>


# OTHER MEDIAS

##### A video walkthrough of this project can be found here: <br> https://drive.google.com/file/d/1KeWoAGGnjBwmaD-MpTzo2HNHr2eeHAuc/view?usp=sharing

##### A pdf version of this analysis can be found here: <br> https://github.com/annguyen1404/JSC370-final/blob/main/pdf-report/jsc370_report.pdf

<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>



# ABOUT THE PROJECT {.tabset}

## The Project

##### This project provides an analysis on NFL field goal kicks of the 2018-2020 seasons. The aim of the project is to help football coaches  assess whether a field goal kick would be successful at a certain game moment to help determine their next game play.

<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>

## Why Football Field Goals?

##### The author of this project, Chloe Nguyen, is a big fan of American football and was very excited upon discovering that JSC370 allowed her the opporunity to unite her interests of football and data science. She was particularly interested in the kicker position (and hence was interested in investigating more on football field goals for the project) because it is the only reasonable football position she can potentially play- as a relatively small person who cannot throw or catch a football. Chloe is a (bandwaggon) Bengals fan and is still devasted over their loss at the last Super Bowl. 

<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>



## The Assignment

##### This project was completed as a part of the final assignment of JSC370, Data Science II, at the University of Toronto.


<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>



# THE ANALYSIS

```{r setup, include=FALSE}
knitr::opts_chunk$set(fig.align='center')
library(tidyverse)
library(data.table)
library(kableExtra)
library(dplyr, warn.conflicts = FALSE)
library(ggplot2)
library(leaflet)
library(mgcv)
library(stringr)
library(broom)
library(grid)   
library(jpeg)

library(rpart)
library(rpart.plot)
library(randomForest)
library(caret)
library(gbm)
library(gridExtra)
library(plotly)

```


```{r data-prep, echo=FALSE, message=FALSE, warning=FALSE}
# Loading in and merging datasets
teams_abbrev <- read_csv("data/nfl_abbrev.csv")
# Substring to get team
teams_abbrev <- teams_abbrev %>%
  mutate(Team = sub('^(.+)[?=" "]', "", teams_abbrev$Name))
teams_loc <- read_csv("data/nfl_locations.csv")
# Fix naming conventions and teams that moved
teams_abbrev[teams_abbrev$Name=="Washington Football Team", "Team"] <- "Redskins"
teams_abbrev[teams_abbrev$Name=="San Francisco 49ers", "Team"] <- "Forty-Niners"
teams_loc[teams_loc$Team=="Rams", "longitude"] <- teams_loc[teams_loc$Team=="Chargers", "longitude"]
teams_loc[teams_loc$Team=="Rams", "latitude"] <- teams_loc[teams_loc$Team=="Chargers", "latitude"]
teams_loc[teams_loc$Team=="Rams", "zip"] <- teams_loc[teams_loc$Team=="Chargers", "zip"]
teams_loc[teams_loc$Team=="Raiders", "longitude"] <- -115.1833 
teams_loc[teams_loc$Team=="Raiders", "latitude"] <- 36.0909
teams_loc[teams_loc$Team=="Raiders", "zip"] <- 89118
teams_info <- merge(x=teams_abbrev,y=teams_loc,by="Team")



games <- read_csv("data/games.csv")
# Fix naming conventions
games[games$homeTeamAbbr=="LA", "homeTeamAbbr"] <- "LAR"
games[games$visitorTeamAbbr=="LA", "visitorTeamAbbr"] <- "LAR"
games[games$homeTeamAbbr=="OAK", "homeTeamAbbr"] <- "LV"
games[games$visitorTeamAbbr=="OAK", "visitorTeamAbbr"] <- "LV"

team_games <- merge(x=games,y=teams_info,by.x="homeTeamAbbr", by.y="Abbreviation", all.x=T)


plays <- read_csv("data/plays.csv")
# Fix naming conventions
plays[plays$possessionTeam=="LA", "possessionTeam"] <- "LAR"
plays[plays$possessionTeam=="OAK", "possessionTeam"] <- "LV"

data <- merge(x=plays,y=team_games, by="gameId", all.x=T)


data <- data %>%
  filter(specialTeamsPlayType=='Field Goal')


players <- read_csv("data/players.csv")

# Convert height in text of feet and inches to cm
players <- players %>% separate(height, c('feet', 'inches'), "-", convert=TRUE, remove = FALSE) %>%
  mutate(height_cm = ifelse(players$height %like% "-", 
                            (12*feet + inches)*2.54, 
                            as.numeric(height)*2.54))

# Change weight to kg
players <- players %>%
  mutate(weight_kg = weight*0.45359237)

# Convert birth date to Date
players$birthDate <- gsub('/', '-', players$birthDate)

players_a <- players %>%
  filter(!(players$birthDate %like% "-[0-9]{4}$")) %>%
  mutate(birthDate = as.Date(birthDate,'%Y-%m-%d'))

players_b <- players %>%
  filter(players$birthDate %like% "-[0-9]{4}$") %>%
  mutate(birthDate = as.Date(birthDate,'%m-%d-%Y'))

players <- rbind(players_a, players_b)



data <- merge(x=data,y=players,by.x="kickerId", by.y="nflId", all.x=T)


# Select relevant variables
data <- data%>%
  select(season, week, gameDate, gameTimeEastern, longitude, latitude, homeTeamAbbr, visitorTeamAbbr, quarter, down, specialTeamsPlayType, specialTeamsResult, possessionTeam, yardlineNumber, gameClock, kickLength, kickerId, height_cm, weight_kg, birthDate, displayName, collegeName, Position)

# Create needed variables
data <- data %>%
  # mutate(birthDate= as.Date(birthDate,'%Y-%m-%d')) %>%
  mutate(birthYear = as.numeric(format(birthDate,'%Y'))) %>%
  mutate(age = season-birthYear) %>%
  mutate(specialTeamsSuccess=ifelse(specialTeamsResult=='Kick Attempt Good', T, F)) %>%
  mutate(possessionTeamHome=ifelse(possessionTeam==homeTeamAbbr, T, F))

data <- data.table(data)

```


<br>
<br>
<br>

## Introduction

In American football, two teams play to advance the football to the opposing side's end zone. Throughout the game, football coaches are heavily involved in calling plays and directing their players through the field. 
	
Arguably the most reliable method of scoring points in football is by kicking the ball through the crossbar. This is the job of a kicker- whose only role in the game is to kick. Unlike many other positions- such as wide receivers, where virtually every moment on the field is different- a kicker's game is one and the same. Because of that, kicks are typically seen as "safe" methods to score and teams rely on kickers to consistently make their shot. While kicking accounts for roughly a third of all NFL scores, because it's not considered as flashy in nature as other football plays, kicking is an immensely underappreciated aspect of the sport.
	
In this report, we will examine the factors that contribute to a field goal kick. The question we are interested in exploring is: what variables should football coaches focus on in determining whether a field goal kick would be successful? In particular, what variables are associated with the kicking length of a field goal and what is the relationship between kicking length and kicking attempt outcome?
	
This project aims to help football coaches  assess whether a field goal kick would be successful at a certain game moment to help determine their next game move.

Before we dive into the analysis, we need to go over common football terminologies:

- A field goal kick is considered 'good' or 'successful' if it managed to score 3 points- that is, the kick went through the goal post.

- The 'starting yard line' or line-of-scrimmage is the line at which a play begins and the line at which the football is set for that play. 


<br>
<br>
<br>

## Methods

<br>

### The Datasets

The dataset we're working with details all special team plays (that is, plays that involve punts, kickoffs, field goals and extra points) in all National Football League (NFL) games from 2018 to 2020. This dataset was provided by the NFL as a part of their 2022 data competition, Big Data Bowl: https://www.kaggle.com/c/nfl-big-data-bowl-2022/overview 

We also refer to this dataset for the locations of NFL teams' home stadiums: https://github.com/Sinbad311/CloudProject/blob/master/NFL%20Stadium%20Latitude%20and%20Longtitude.csv

Additionally, we use this dataset for the abbreviations of NFl teams: https://gist.github.com/cnizzardini/13d0a072adb35a0d5817

<br>

### The Tools

We'll use dplyr to help merge all datasets and create new variables. Additionally, we'll use ggplot to create all static plots, plotly for all interactive plots and leaflet for the map. We'll also use broom to tidy all raw outputs and to format all tables with kable. For loading in the image and coordinating the points of the football field plots, we'll use jpeg and grid.

<br>

### Data Wrangling

First, we merge the data of team abbreviations with team locations (longittude and lattitude) by teams. Note that there were NFL teams that changed their name throughout the years- such as the Washington Football Team who also went by the Washington Redskins. Hence, these names need to be modified to match for the datasets to be properly merged. Moreover, there were teams that recently moved to a different location (e.g. Las Vegas Raiders) and thus, we need to update their location to match their current state. We'll use external sources to check the new location of the team and input in this new value. 

We then merge this dataset of team abbreviations and locations with the games data set by home team abbreviation to get the location of where each game was played. Once again, we have to fix team naming conventions so that they match up in order to merge the datasets. Next, we merge this new dataset with the game plays dataset by gameId. This gives us the game information and location of each game play. Again, we have to fix team naming conventions so that they match up in order to merge the datasets. Note that in this analysis, we want to only examine field goals, so we'll filter for plays that are 'Field Goal'.

Additionally, we merge this new dataset of field goal plays with a dataset of players by kickerId to get more information on the athlete who kicked the ball in each game play. However, before the merge, we need to standardize entries in the players dataset. Since the entries of height for this dataset are partially recorded in just inches and partially recorded in both feet and inches, we convert all entries of height to cm. We also convert all entries of weight to kg. Next, we convert all birth dates to Date objects. For this variable, some entries have the year listed first and some have the year listed last. To standardize, we match date entries by regex to get the date formate in order to convert them to Dates. For example, the regex "-[0-9]{4}$" checks that the year is formatted first and hence, we are able to create our Date object approporiately.

Now, we select the variables relevant to our question of interest: season, week, gameDate, gameTimeEastern, longitude, latitude, homeTeamAbbr, visitorTeamAbbr, quarter, down, specialTeamsPlayType, specialTeamsResult, possessionTeam, yardlineNumber, gameClock, kickLength, kickerId, height_cm, weight_kg, birthDate, displayName, collegeName, Position. 

With that, we created the following variables of interest:

- birthYear: The year that the player kicking the ball was born

- age: The age of the player at the time of kick

- specialTeamsSuccess: Whether or not the kick attempt was classified as "good"

- possessionTeamHome: Whether or not the team in posession of the ball is the home team

<br>

## Exploring the Variables

We first take a look at all the variables of the final dataset that we are working with, their types, whether they are numerical or categorical and the number of missing entires they have. 

```{r, echo=FALSE, message=FALSE, warning=FALSE}
# Numerical variables
numerical_vars <- c("season", "week", "gameDate", "gameTimeEastern", "longitude", "latitude", "yardlineNumber", "gameClock", "kickLength", "height_cm", "weight_kg", "birthDate", "down", "quarter", "kickerId", "age")

# Columns type
data_numcat <- sapply(colnames(data), function(x) ifelse(x %in% numerical_vars, "numerical", "categorical"))
data_type <- sapply(data, typeof)

# Table for variables summary
tibble(`Column` = colnames(data),
       Type = data_type,
       `Numerical or Categorical`= data_numcat,
       `Number of NAs` = sapply(data, function(x) sum(is.na(x)))) %>%
  kbl(caption = "<strong><center>Overview of Variables<center><strong>") %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = F)
```

After that, we impute missing values for relevant variables. Note that we use the mean for numerical values and the median for categorical values.

```{r, echo=FALSE, message=FALSE, warning=FALSE}
# Impute missing values for relevant variables. Note that we use mean for numerical values and median for categorical values.

data[, birthDate := fcoalesce(birthDate, median(birthDate, na.rm = TRUE)),
 by = .(possessionTeam, season)]
data[, birthYear := fcoalesce(birthYear, median(birthYear, na.rm = TRUE)),
 by = .(possessionTeam, season)]
data[, height_cm := fcoalesce(height_cm, median(height_cm, na.rm = TRUE)),
 by = .(possessionTeam, season)]
data[, kickLength := fcoalesce(kickLength, mean(kickLength, na.rm = TRUE)),
 by = .(possessionTeam, season)]
  data[, weight_kg:= fcoalesce(weight_kg, median(weight_kg, na.rm = TRUE)),
 by = .(possessionTeam, season)]
```

The dataset is now ready to be explored.

<br>
<br>
<br>

## Results

First, we visualise kicking locations by viewing a plot of the line-of-scrimmage of field goal attempts. From the plot we see that most attempts were roughly from the 20 yard line. Additionally, we also discover that the number of field goal attempts significantly dropped at around the 40 yard line and further.

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.align='center'}
# Load in image of football field
field <- readJPEG("assets/field.jpg")
field <- rasterGrob(field, width=unit(1,"npc"), height=unit(1,"npc"))

# Gets count
get_num <- function(x){
  length(x)
}

# Plot yard line distance on football field with count of attempts
data %>%
  ggplot( aes(x=yardlineNumber, y=26.65, z=specialTeamsSuccess)) +
  annotation_custom(field, -16, 116, 0, 53.3)+  
  stat_summary_2d(fun = get_num, bins=25, alpha = 0.5)+
  scale_fill_gradient(low = "red", high = "yellow", name = "Count of Field Goal Attempts")+
  ylim(0, 53.3) + 
  xlim(-16, 116)+   
  coord_equal()+
  theme_void() +
  labs(title = "Count of Field Goal Attempts in 2018-2020\nBy Line-Of-Scrimmage Yard Line", x=NULL, y=NULL)+
  theme(
     text = element_text(color="#666666", face="bold"),
     plot.title = element_text(color="#666666", size=15, face="bold", hjust = 0.5),
     plot.margin=grid::unit(c(0,0,0,0), "mm"))

```

<br>

Next, we take a look at the proportion of successful kicks at various line-of-scrimmage yard lines. We see that the success proportion was quite consistent for attempts at roughly the 47 yard line and under. However for field goal attempts over 47 yards, the success dropped significantly. Most kicks at these yard lines were unsuccessful.

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.align='center'}

# Get proportion of true
get_prop <- function(x){
  (sum(x)/length(x))
}

# Plot yard line distance on football field with proportion of success
data %>%
  ggplot( aes(x=yardlineNumber, y=26.65, z=specialTeamsSuccess)) +
  annotation_custom(field, -16, 116, 0, 53.3)+  
  stat_summary_2d(fun = get_prop, bins=25, alpha = 0.5)+
  scale_fill_gradient(low = "red", high = "yellow", name = "Proportion of Successful\nField Goal Attempts")+
  ylim(0, 53.3) + 
  xlim(-16, 116)+   
  coord_equal()+
  theme_void()+
  labs(title = "Successful Field Goal Attempts in 2018-2020\nBy Line-Of-Scrimmage Yard Line", x=NULL, y=NULL)+
  theme(
     text = element_text(color="#666666", face="bold"),
     plot.title = element_text(color="#666666", size=15, face="bold", hjust = 0.5),
     plot.margin=grid::unit(c(0,0,0,0), "mm")
  )

```

<br>

We then take an overview of each team's field goal success rate by the starting yard line. From the plot, we can see that the furthest successful kick attempts in 2018-2020 were between the 45-50 yard line and completed by the Dallas Cowboys (DAL) and the Carolina Panthers (CAR). Additionally, while most teams that attempted close field goal kicks (between the 0 to 5 yard line) scored 100% of their attempts, the Miami Dolphins (MIA) and Philadelphia Eagles (PHI) were less successful. The teams with the shortest max yard line successful kicks were the Minesota Vikings (MIN) and the New England Patriots (NE). Both teams's furthest successful kick were between the 30-35 yard line.

```{r, echo=FALSE, message=FALSE, warning=FALSE}

data <- data %>%
  mutate(yardlineInt = (findInterval(yardlineNumber, seq(0, 60, 5))-0.5)*5)

data_yardline <- data %>%
  group_by(yardlineInt, possessionTeam) %>%
  summarise (
    attempts = n(),
    prop_success = mean(specialTeamsSuccess))




data_yardline %>%
  plot_ly(x=~yardlineInt, y=~possessionTeam, z=~prop_success, type="heatmap",
          colorbar= list(title='Success Rate'),
          hoverinfo = 'text',
            text = ~paste("Team:", data_yardline$possessionTeam,
                          "<br> Yard Line:", data_yardline$yardlineInt-2.5, "to",
                          data_yardline$yardlineInt+2.5,
                          "<br> Success Rate:", round(data_yardline$prop_success, 2),
                          "<br> Attempts:", data_yardline$attempts)) %>%
  layout(title="Field Goal Attempt Success Rate by Yard Line per Team in 2018-2020", 
         yaxis=list(title="NFL Teams", autorange="reversed", dtick=1),
         xaxis=list(title="Yard Line"),
         hovermode="compare") 


```


<br>

From this, we investigate the average field goal performance of each team by average starting yard line over the 3 seasons. In this plot, each dot size corresponds to the number of field goal attempts made by each team in a season. Notice that most average success rates were above 75%. Moreover, we see that the Tennessee Titans (TEN) were the least successful team compared to all others NFL teams. From external knowledge, the Tennessee Titan’s main kicker was injured in 2019 and hence, was unable to play- leading the team to go through four different kickers with evidently little success. The team with the highest success proportion is the Baltimore Ravens (BAL) with 92%. Their kicker, Justin Tucker, currently holds the title as the most accurate kicker in NFL history.


```{r, echo=FALSE, message=FALSE, warning=FALSE}

data_team_season <- data %>%
  group_by(possessionTeam) %>%
  summarise (
    attempts = n(),
    prop_success = mean(specialTeamsSuccess),
    avg_yardline = mean(yardlineNumber))

data_team_season %>%
  plot_ly(x=~avg_yardline, y=~prop_success, type='scatter',
          mode="markers", color=~possessionTeam,
          size=~attempts, sizes = c(5, 70), marker=list(sizemode='diameter', opacity = 0.5),
          hover_info="text",
          text = ~paste(paste0("Team: ", possessionTeam),
                        paste0("Number of Attempts: ", attempts),
                        paste0("Proportion of Successful Kicks: ", round(prop_success, 2)),
                        paste0("Average Yard Line: ", round(avg_yardline, 2)),
                        sep="<br>"))  %>%
  layout(title="Average Yard Line vs. Proportion of Successful Kicks <br> by Teams (2018-2020)", 
         yaxis=list(title="Proportion of Successful Kicks"),
         xaxis=list(title="Average Yard Line"),
         hovermode="compare")

```

<br>

Taking a look at the summary table for kick length by special teams results, we can see that the mean of a "no good" kick or an unsuccessful kick (46.52 yards) was higher than that of a "good" kick or a successful kick (36.70). Moreover, the overall minimum kicking length was 19 yards and it was a successful kick; while the overall maximum kicking length attempt was 67 yards and was unsuccessful. We also note that there was only 1 downed kick and 1 out of bounds kick in all of the 2018-2020 seasons. 

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.align='center'}
# Summary of kick length by special teams result
data_result <- data %>%
  group_by(specialTeamsResult) %>%
  summarise(
    min_kickLength= min(kickLength),
    max_kickLength= max(kickLength),
    mean_kickLength= mean(kickLength),
    sd_kickLength = sd(kickLength),
    range_kickLength= max(kickLength)-min(kickLength))

# Table for summary
kbl(data_result, 
    caption = "Summary of Kick Length by Special Team Result", 
    col.names = c("Special Teams Result", "Min", "Max", "Mean", 
                  "Standard Deviation","Range"),
    align='c',
    digits=2) %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = F)
  
```

<br>

Next, we explore the kicking length by NFL teams in the 2018-2020 season. From the boxplot, the Denver Broncos (DEN) and Tennessee Titans (TEN) had the highest average kicking lengths at roughly 42 yards. The team with the lowest average kick length was the Las Vegas Raiders (LV) at roughly 35 yards.

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.align='center'}
# Kick Length by NFL Teams
colour <- colorRampPalette(c("#C06C84", "#355C7D"))
data %>%
  ggplot( aes(y=kickLength, x=possessionTeam)) +
  geom_boxplot( fill=colour(32), color="#666666", alpha=0.7)+
  labs(title = "Boxplot of Kicking Length by NFL Teams in 2018-2020") +
  xlab("NFL Teams") +
  scale_x_discrete(guide = guide_axis(angle = 90)) +
  ylab("Kick Length (yards)") +
  theme_minimal() +
  theme(
     plot.title = element_text(color="#666666", size=15, face="bold", hjust = 0.5),
    axis.title.x = element_text(color="#666666", size=11,face="bold"),
    axis.title.y = element_text(color="#666666", size=11, face="bold")
  )
```

<br>

Moving on, we further examine the kick length of successful and unsuccessful field goal attempts for every team. We see that the median kicking length of every team is higher for successful kicks than for unsuccessful kicks. Of the successful kicks, the Denver Broncos (DEN) has the highest kick length median at roughly 40 yards. The lowest median for successful kicks belongs to the Las Vegas Raiders (LV) at 33 yards. 

```{r, echo=FALSE, message=FALSE, warning=FALSE}

data %>% plot_ly(
  y = ~kickLength,
  x = ~possessionTeam,
  color = ~specialTeamsSuccess,
  type = "box"
) %>%
  layout(title="Kick Length of Successful and Unsuccessful Field Goal Attempts \n per Team for 2018-2020",
         yaxis=list(title="Kick length (yards)"),
         xaxis=list(title="Team"),
         legend=list(title=list(text='Successful Kicks')),
         hovermode="compare")
```

<br>

Perhaps kickers who are taller and have longer legs would be able to kick further lengths? On that train of thought, we examine the plots of kick length vs. kicker height for successful and unsuccessul kicks. We see that for both kick results, the linear regression line is almost completely flat and the points do not follow a particular pattern. Hence, there is essentially no association between these a kicker's height and their kick length- whether the kick is successful or unsuccessful.

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.align='center'}

# Kick length vs. Kicker Height
ggplot(data, aes(y=kickLength, x=height_cm, color=specialTeamsSuccess)) +
  geom_point() +
  geom_smooth(method = "lm") +
  scale_color_manual("Special Teams Success", values=c("#c87e93", "#6b4b86")) +
  labs(title = "Kick Length vs. Kicker Height") +
  xlab("Height (cm)") +
  ylab("Kick Length (yards)") +
  theme_minimal() +
  theme(
     plot.title = element_text(color="#666666", size=15, face="bold", hjust = 0.5),
    axis.title.x = element_text(color="#666666", size=11,face="bold"),
    axis.title.y = element_text(color="#666666", size=11, face="bold")
  )

```

Maybe kickers with more mass would have more power and would be able to kick longer lengths? With our data, we plot kick length vs. kicker weight for successful and unsuccessul kicks. From this, we also see that for both kick results, the linear regression line is almost completely flat and the points do not follow a particular pattern. Thus, there is no association between these a kicker's weight and their kick length- whether the kick is successful or unsuccessful.

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.align='center'}

# Kick length vs. Kicker Weight
ggplot(data, aes(y=kickLength, x=weight_kg, color=specialTeamsSuccess)) +
  geom_point() +
  geom_smooth(method = "lm") +
  scale_color_manual("Special Teams Success", values=c("#c87e93", "#6b4b86")) +
  labs(title = "Kick Length vs. Kicker Weight") +
  xlab("Weight (kg)") +
  ylab("Kick Length (yards)") +
  theme_minimal() +
  theme(
     plot.title = element_text(color="#666666", size=15, face="bold", hjust = 0.5),
    axis.title.x = element_text(color="#666666", size=11,face="bold"),
    axis.title.y = element_text(color="#666666", size=11, face="bold")
  )

```

<br>

Next, we visualize the teams and their home stadiums on a map.

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.align='center'}

# Map of NFL stadiums
icon <- awesomeIcons(
  icon = 'ios-close',
  iconColor = 'gray',
  library = 'ion',
  markerColor = "gray"
)
  
iconsTeams <- icons(
  iconUrl =  
    ifelse(teams_info$Abbreviation=="ARI",
           "https://loodibee.com/wp-content/uploads/nfl-arizona-cardinals-team-logo-2.png",
    ifelse(teams_info$Abbreviation=="ATL", 
           "https://loodibee.com/wp-content/uploads/nfl-atlanta-falcons-team-logo-2.png",
    ifelse(teams_info$Abbreviation=="BAL",
            "https://loodibee.com/wp-content/uploads/nfl-baltimore-ravens-team-logo-2.png",
    ifelse(teams_info$Abbreviation=="BUF", 
           "https://loodibee.com/wp-content/uploads/nfl-buffalo-bills-team-logo-2.png",
    ifelse(teams_info$Abbreviation=="CAR",
           "https://loodibee.com/wp-content/uploads/nfl-carolina-panthers-team-logo-2.png",
    ifelse(teams_info$Abbreviation=="CHI",
           "https://loodibee.com/wp-content/uploads/nfl-chicago-bears-team-logo-2.png",
    ifelse(teams_info$Abbreviation=="CIN",
           "https://loodibee.com/wp-content/uploads/nfl-cincinnati-bengals-team-logo.png",
    ifelse(teams_info$Abbreviation=="CLE",
           "https://loodibee.com/wp-content/uploads/nfl-cleveland-browns-team-logo-2.png",
    ifelse(teams_info$Abbreviation=="DAL",
           "https://loodibee.com/wp-content/uploads/nfl-dallas-cowboys-team-logo-2.png",
    ifelse(teams_info$Abbreviation=="DEN",
           "https://loodibee.com/wp-content/uploads/nfl-denver-broncos-team-logo-2.png",
    ifelse(teams_info$Abbreviation=="DET",
           "https://loodibee.com/wp-content/uploads/nfl-detroit-lions-team-logo-2.png",
    ifelse(teams_info$Abbreviation=="GB",
           "https://loodibee.com/wp-content/uploads/nfl-green-bay-packers-team-logo-2.png",
    ifelse(teams_info$Abbreviation=="HOU",
           "https://loodibee.com/wp-content/uploads/nfl-houston-texans-team-logo-2.png",
    ifelse(teams_info$Abbreviation=="IND",
           "https://loodibee.com/wp-content/uploads/nfl-indianapolis-colts-team-logo-2.png",
    ifelse(teams_info$Abbreviation=="JAX",
           "https://loodibee.com/wp-content/uploads/nfl-jacksonville-jaguars-team-logo-2.png",
    ifelse(teams_info$Abbreviation=="KC",
           "https://loodibee.com/wp-content/uploads/nfl-kansas-city-chiefs-team-logo-2.png",
    ifelse(teams_info$Abbreviation=="LV",
           "https://loodibee.com/wp-content/uploads/nfl-oakland-raiders-team-logo.png",
    ifelse(teams_info$Abbreviation=="LAC",
           "https://loodibee.com/wp-content/uploads/nfl-los-angeles-chargers-team-logo-2.png",
    ifelse(teams_info$Abbreviation=="LAR",
           "https://loodibee.com/wp-content/uploads/los-angeles-rams-2020-logo-300x300.png",
    ifelse(teams_info$Abbreviation=="MIA",
           "https://loodibee.com/wp-content/uploads/nfl-miami-dolphins-team-logo-2.png",
    ifelse(teams_info$Abbreviation=="MIN",
           "https://loodibee.com/wp-content/uploads/nfl-minnesota-vikings-team-logo-2.png",
    ifelse(teams_info$Abbreviation=="NE",
           "https://loodibee.com/wp-content/uploads/nfl-new-england-patriots-team-logo-2.png",
    ifelse(teams_info$Abbreviation=="NO",
           "https://loodibee.com/wp-content/uploads/nfl-new-orleans-saints-team-logo-2.png",
    ifelse(teams_info$Abbreviation=="NYG",
           "https://loodibee.com/wp-content/uploads/nfl-new-york-giants-team-logo-2.png",
    ifelse(teams_info$Abbreviation=="NYJ",
           "https://loodibee.com/wp-content/uploads/nfl-new-york-jets-team-logo.png",
    ifelse(teams_info$Abbreviation=="PHI",
           "https://loodibee.com/wp-content/uploads/nfl-philadelphia-eagles-team-logo-2.png",
    ifelse(teams_info$Abbreviation=="PIT",
           "https://loodibee.com/wp-content/uploads/nfl-pittsburgh-steelers-team-logo-2.png",
    ifelse(teams_info$Abbreviation=="SF",
           "https://loodibee.com/wp-content/uploads/nfl-san-francisco-49ers-team-logo-2.png",
    ifelse(teams_info$Abbreviation=="SEA",
           "https://loodibee.com/wp-content/uploads/nfl-seattle-seahawks-team-logo-2.png",
    ifelse(teams_info$Abbreviation=="TB",
           "https://loodibee.com/wp-content/uploads/tampa-bay-buccaneers-2020-logo-830x830.png",
    ifelse(teams_info$Abbreviation=="TEN",
           "https://loodibee.com/wp-content/uploads/nfl-tennessee-titans-team-logo-2.png",
           "https://loodibee.com/wp-content/uploads/washington-commanders-logo-830x830.png"))))))))))))))))))))))))))))))), iconWidth = 40, iconHeight = 40
)

teams_info %>% 
  leaflet() %>% 
  addProviderTiles("CartoDB.Positron") %>%
  addMarkers(lat=~latitude, lng=~longitude, label=~paste0('NFL Team: ', Name), icon = iconsTeams, clusterOptions = markerClusterOptions()) 

```


<br>

From examing the locations of the various team stadiums, we are interested in determining whether there is a change in average kick distance between plays in stadiums of high and low altitudes. In theory, high altitudes allows for better football performance since air pressure is lower and hence, the ball moves faster and straighter.

We use external resources to find the top 3 team stadiums at the highest and lowest altitudes:

- Highest altitudes: Denver Broncos (DEN), Arizona Cardinals (ARI), Atlanta Falcons (ATL)

- Lowest altitudes: New Orleans Saints (NO), New York Giants (NYG), New York Jets (NYJ)

Then, we'll filter for two groups: one with kicks from the top 3 highest altitude stadiums and one with kicks from the top 3 lowest altitude stadiums. Using a Wilcoxon 2-sample t-test, we check if there was a significant difference in kick lengths between these two independent groups.

```{r, echo=FALSE, message=FALSE, warning=FALSE}
data_high_elev <- data %>%
  filter((homeTeamAbbr == 'DEN'|homeTeamAbbr == 'ARI'|homeTeamAbbr == 'ATL') & specialTeamsSuccess==1) %>%
  group_by(possessionTeam) %>%
  summarise(
    success_prop = mean(specialTeamsSuccess, na.rm=T),
    avg_yard = mean(yardlineNumber, na.rm=T),
    avg_kickLength = mean(kickLength, na.rm=T)
  )

data_low_elev <- data %>%
  filter((homeTeamAbbr == 'NO'|homeTeamAbbr == 'NYG'|homeTeamAbbr == 'NYJ') & specialTeamsSuccess==1) %>%
  group_by(possessionTeam) %>%
  summarise(
    success_prop = mean(specialTeamsSuccess, na.rm=T),
    avg_yard = mean(yardlineNumber, na.rm=T),
    avg_kickLength = mean(kickLength, na.rm=T)
  )

test <- wilcox.test(data_high_elev$avg_kickLength, data_low_elev$avg_kickLength, paired = F) %>% tidy
test["alternative"] <- "Two sided"
test["p.value"] <- format(round(test$p.value, digits=2), nsmall = 2) 
# Table for summary
kbl(test, 
    caption = "Wilcoxon 2-sample t-test - High vs. Low Elevation", 
    col.names = c("Statistic", "P-Value", "Method", "Alternative"),
    align='c',  booktabs = T) %>%
  kable_styling(bootstrap_options = c("striped"), full_width = F , latex_options = "hold_position")

```

With a p-value of 0.10, there is very weak evidence supporting the alternative hypothesis that there is a significant difference in kick lengths between kicks in high altitude stadiums and kicks in low altitude stadiums.

<br>

On top of that, we are also interested in whether teams performed better in terms of field goal success when they play home games vs. away games. For home games, players would have familiarity with the field- seeing as that is where they usually practice. Additionally, morale would be higher at home games since they would have their home crowd cheering for them. This may help to boost their performance and hence, increase their success with field goals.

We'll use a Wilcoxon signed-rank test to see if there was a significance difference in proportions of successful kicks for teams when playing home games vs. away games.

```{r, echo=FALSE, message=FALSE, warning=FALSE}
data_home <- data %>%
  filter(possessionTeamHome==F) %>%
  group_by(possessionTeam) %>%
  summarise(
    success_prop = mean(specialTeamsSuccess, na.rm=T),
    avg_yard = mean(yardlineNumber, na.rm=T),
    avg_kickLength = mean(kickLength, na.rm=T)
  )

data_away <- data %>%
  filter(possessionTeamHome==T) %>%
  group_by(possessionTeam) %>%
  summarise(
    success_prop = mean(specialTeamsSuccess, na.rm=T),
    avg_yard = mean(yardlineNumber, na.rm=T),
    avg_kickLength = mean(kickLength, na.rm=T)
  )

test <- wilcox.test(data_home$success_prop, data_away$success_prop, paired = T) %>% tidy
test["alternative"] <- "Two sided"
test["p.value"] <- format(round(test$p.value, digits=2), nsmall = 2) 
# Table for summary
kbl(test, 
    caption = "Wilcoxon signed-rank test - Home vs. Away", 
    col.names = c("Statistic", "P-Value", "Method", "Alternative"),
    align='c',  booktabs = T) %>%
  kable_styling(bootstrap_options = c("striped"), full_width = F , latex_options = "hold_position")
```

With a large p-value of 0.44, we cannot reject the null hypothesis that there was no significant difference in proportion of successful kicks between home games and away games. This result is not too surprising seeing that the most important characteristic that NFL teams look for when signing their kicker is consistency. Teams want kickers who they can count on to score regardless of whether they are playing home games or an away games since field goals are considered a "safe" method of scoring.

<br>

### Modelling

To begin, we group our data of game plays by posessionTeam (the team that is kicking the ball) and season. In the process, we summarise to find: the proportion of successful kick attempts (success_prop), the average height of the kicker (avg_height), the average weight of the kicker (avg_weight), the average age at time of kick of the kicker (avg_age), the proportion of these kicks that were done during a home game (home_prop), the average kick length in yards (avg_kickLength).

To evaluate the relationship between kick length and successful kicking attempts and to explore the association of other factors in a successful kick, we'll fit 2 models to this grouped data. The first model is a multiple linear regression (MLR) model for success_prop with predictors: avg_height, avg_weight, avg_age, home_prop and avg_kickLength. The second model uses cubic regression spline and only takes into account avg_kickLength.

<br>

#### Multiple Linear Regression Model

From the summary, the p-value associated with average kick length is 0.000772 and hence, is statistically significant. From this, we have very strong evidence that a 1 yard increase in kicking distance is associated with an average decrease of -0.015% in season field goal kick success proportion. This decrease in success may be due to loss of accuracy when kicking longer lengths. Additionally, the intercept has a p-value of statistically 0.002857 and is also signficant significant. 

With an adjusted $R^2$ value of 0.08246, approximately 8.246% of variation in season success proportion could be explained by average height, average weight, average age, proportion of home games played and average kick length.

```{r, echo=FALSE, message=FALSE, warning=FALSE}
data_teams <- data %>%
  group_by(possessionTeam, season) %>%
  summarise(
    success_prop = mean(specialTeamsSuccess, na.rm=T),
    avg_height = mean(height_cm, na.rm=T),
    avg_weight = mean(weight_kg, na.rm=T),
    avg_age = mean(season-birthYear, na.rm=T),
    home_prop = mean(possessionTeamHome, na.rm=T),
    avg_kickLength = mean(kickLength, na.rm=T)
  )
```

```{r, echo=FALSE, message=FALSE, warning=FALSE, output="asis"}

mod1 <- lm(success_prop~ avg_height+avg_weight+avg_age+home_prop+avg_kickLength, data = data_teams)

sum1 <- summary(mod1)
sum1_tidy <- sum1 %>% tidy

# Tables for model summary
kbl(sum1_tidy,
    caption = "Model Summary - MLR",
    col.names = c("Term", "Estimate", "Standard Error", "Statistic", "P-Value"),
    align='c',  booktabs = T) %>%
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = F, latex_options = "hold_position")

tibble(`R Squared` = sum1$r.squared,
       `Adjusted R Squared` = sum1$adj.r.squared) %>%
  kbl(caption = "Model Summary - R Squared and Adjusted R Squared", align='c',  booktabs = T) %>%
  kable_styling(bootstrap_options = c("striped"), full_width = F , latex_options = "hold_position")

```

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.align='center'}

ggplot(data_teams, aes(x=avg_kickLength, y=success_prop)) +
  geom_point() +
  geom_abline(slope = coef(mod1)[["avg_kickLength"]],
              intercept = coef(mod1)[["(Intercept)"]], color="#C04863", size=1)+
  labs(title = "Proportion of Successful Kicks vs. Average Kick Lengths \n in Singular Season",
       subtitle= "Model: MLR of FEV by Weight, Age, Sex and Race") +
  xlab("Kick Length (yards)") +
  ylab("Proportion of Successful Kicks") +
  theme_minimal() +
  theme(
     plot.title = element_text(color="#666666", size=14, face="bold", hjust = 0.5),
     plot.subtitle = element_text(color="#666666", size=13, hjust = 0.5),
    axis.title.x = element_text(color="#666666", size=11,face="bold"),
    axis.title.y = element_text(color="#666666", size=11, face="bold"),
     plot.margin=grid::unit(c(0,0,0,0), "mm")
  )


```


<br>

#### Model with Cubic Regression Spline

In this model, kick length is our smooth term. The associated p-value is 0.000321 and hence, is statistically significant. From the summary, the effective degree of freedom is 5.188 and thus, the curve of kick length is slightly more complex than a quintic curve. Moreover, the intercept has a p-value of less than $2 \times 10^{-16}$ and hence, is also statistically significant.

With an adjusted $R^2$ value of 0.221, roughly 22.1% of the data fits the model with cubic regression spline. This adjusted $R^2$ value is higher than that of the MLR model. Hence, this model is a better fit for the data.


```{r, echo=FALSE, message=FALSE, warning=FALSE}

mod2 <-gam(success_prop~s(avg_kickLength,bs="cr", k=10),data = data_teams)

sum2 <- summary(mod2)
sum2_tidy <- tidy(mod2)


# Tables for model summary
tibble(`Estimate` = sum2$p.coeff,
       `Standard Error` = sum2$se["(Intercept)"],
       `T Value` = sum2$p.t,
       `P-Value` = sum2$p.pv) %>%
  kbl(caption = "Model Summary - Parametric Coefficients", align='c',  booktabs = T) %>%
  kable_styling(bootstrap_options = c("striped"), full_width = F , latex_options = "hold_position")

kbl(sum2_tidy,
    caption = "Model Summary - Smooth Terms",
    col.names = c("Term", "Estimated Degree of Freedom", "Reference Degree of Freedom", "Statistic", "P-Value"),
    align='c',  booktabs = T) %>%
  kable_styling(bootstrap_options = c("striped"), full_width = F , latex_options = "hold_position")

tibble(`Adjusted R Squared` = sum2$r.sq,
       `Deviance Explained` = sum2$dev.expl) %>%
  kbl(caption = "Model Summary - Adjusted R Squared and Deviance Explained", align='c',  booktabs = T) %>%
  kable_styling(bootstrap_options = c("striped"), full_width = F , latex_options = "hold_position")

```


```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.align='center'}

ggplot(data_teams, aes(x=avg_kickLength, y=success_prop)) +
  geom_point() +
  geom_smooth(method = "gam", formula = y ~ s(x, k = 10), color="#C04863") +
  labs(title = "Proportion of Successful Kicks vs. Average Kick Lengths \n in Singular Season",
       subtitle = "Model With Cubic Regression Spline") +
  xlab("Kick Length (yards)") +
  ylab("Proportion of Successful Kicks") +
  theme_minimal() +
  theme(
     plot.title = element_text(color="#666666", size=14, face="bold", hjust = 0.5),
     plot.subtitle = element_text(color="#666666", size=13, hjust = 0.5),
    axis.title.x = element_text(color="#666666", size=11,face="bold"),
    axis.title.y = element_text(color="#666666", size=11, face="bold"),
     plot.margin=grid::unit(c(0,0,0,0), "mm")
  )
    

```


<br>

### Predicting

Using ML, we attempt to predict whether or not a kick is successful with the following variables:
season, week, gameTimeEastern, longitude, latitude, homeTeamAbbr, visitorTeamAbbr, quarter, down, posessionTeam, gameClock, heigh_cm, weight_kg, age, posessionTeamHome

This section aims to help coaches  assess the likeliness of a kick being successful at a certain point during a football game. Hence the predictor variables chosen are all variables that coaches would have  assess to during a game. Through the variable importance plots, we hope to give coaches a better sense of what variables to pay attention to when deciding whether or not a kick will be successful and hence, help to determine whether or not coaches should call for field goal kick plays.

```{r, echo=FALSE, message=FALSE, warning=FALSE}
 # Split data into train and test
set.seed(111)
train_idx <- sample(1:nrow(data), round(0.7*nrow(data)))
train <- data[train_idx,] %>%
  select(c(specialTeamsSuccess, season, week, gameTimeEastern, longitude, latitude, homeTeamAbbr, visitorTeamAbbr, quarter, down, possessionTeam, gameClock, height_cm, weight_kg, age, possessionTeamHome, yardlineNumber))
test <- data[-train_idx,] %>%
  select(c(specialTeamsSuccess, season, week, gameTimeEastern, longitude, latitude, homeTeamAbbr, visitorTeamAbbr, quarter, down, possessionTeam, gameClock, height_cm, weight_kg, age, possessionTeamHome, yardlineNumber))

```

<br>

#### Pruned Tree

The first model we'll fit is a decision tree. We will prune this tree so that it is not overly complicated. Note that the optimal complexity parameter was the determined by looking for the minimum 'xerror'. The pruned tree splits on only a single variable, yardlineNumber. From this tree, 34% of kicks starts at yard line 26 or more and have a success probability of 66%. Additionally, 66% of kicks start at yard line less than 26 and have a success probability of 99%.

```{r, echo=FALSE, message=FALSE, warning=FALSE, include=FALSE}

treefit <- rpart(specialTeamsSuccess~., method="anova", control=list(cp=0), data=train)

```

```{r, echo=FALSE, message=FALSE, warning=FALSE}

optimalcp <- treefit$cptable[which.min(treefit$cptable[,"xerror"]), "CP"]

tree_prune <- prune(treefit, cp=optimalcp)
rpart.plot(tree_prune)

# Predicting
tree_pred <- predict(tree_prune, test)

```

<br>

#### Bagging

We then try a bagging model. From the variable importance plot, yardlineNumber has the highest importance. This follows from the results of our pruned tree- seeing that yardlineNumber was the only variable that the tree had split on. This makes sense as the larger the yard line number, the further away a kicker must start to kick the ball through the goal post. Surprisingly, game clock is the second most important variable. This may be because a big factor in kicking is performance under pressure. The closer the clock is to the end of the quarter, the more pressure there is for a team to score. While a kicker's job is under relatively similar physical conditions for most games, they may be under different amounts of pressure depending on the team's current stance. Pressure may play a determining role in a kicker's performance.

```{r, echo=FALSE, message=FALSE, warning=FALSE, include=FALSE}

set.seed(111)
num_vars <- ncol(train)-1
bag <- randomForest(specialTeamsSuccess~., data=train, mtry=num_vars, na.action=na.omit)
imp <- varImpPlot(bag, n.var=num_vars)
imp <- as.data.frame(imp)
imp$varnames <- rownames(imp) # row names to column
rownames(imp) <- NULL  

# Predicting
bag_pred <- predict(bag, test)

```

```{r, echo=FALSE, message=FALSE, warning=FALSE}
colour <- colorRampPalette(c("#355C7D", "#C06C84"))

ggplot(imp, aes(x=reorder(varnames, IncNodePurity), weight=IncNodePurity)) + 
  geom_bar(fill=colour(nrow(imp)), alpha = 0.7) +
  ylab("IncNodePurity") +
  xlab("Variable Name") +
  coord_flip() +
  labs(title = "Bagging - Variable Importance") +
  theme_minimal() +
  theme(
     plot.title = element_text(color="#666666", size=15, face="bold", hjust = 0.5),
    axis.title.x = element_text(color="#666666", size=11,face="bold"),
    axis.title.y = element_text(color="#666666", size=11, face="bold")
  )
```

<br>

#### Random Forest

Afterwards, we fit a random forest model. From the variance importance plot, the variable that contributes most to the model's decision is yardlineNumber- followed by game clock. This echos the variable importance of the pruned tree model and informs us that coaches should take these variables into strong consideration in determining whether or not a field goal kick would be successful.

```{r, echo=FALSE, message=FALSE, warning=FALSE, include=FALSE}
set.seed(123)
num_vars <- ncol(train)-1
rf <- randomForest(specialTeamsSuccess~., data=train, na.action=na.omit)

imp <- varImpPlot(rf, n.var=num_vars)
imp <- as.data.frame(imp)
imp$varnames <- rownames(imp) # row names to column
rownames(imp) <- NULL  

# Predicting
rf_pred <- predict(rf, test)

```


```{r, echo=FALSE, message=FALSE, warning=FALSE}
colour <- colorRampPalette(c("#355C7D", "#C06C84"))

ggplot(imp, aes(x=reorder(varnames, IncNodePurity), weight=IncNodePurity)) + 
  geom_bar(fill=colour(nrow(imp)), alpha = 0.7) +
  ylab("IncNodePurity") +
  xlab("Variable Name") +
  coord_flip() +
  labs(title = "Random Forest - Variable Importance") +
  theme_minimal() +
  theme(
     plot.title = element_text(color="#666666", size=15, face="bold", hjust = 0.5),
    axis.title.x = element_text(color="#666666", size=11,face="bold"),
    axis.title.y = element_text(color="#666666", size=11, face="bold")
  )
```


<br>

#### Comparing the ML Models

With the models we fitted, we predict on the test data to determine which model performs best. Comparing MSEs, we found that the random forest model generalized best and the pruned tree model generalized worst- however, all models were very close to each other. With that said, the random forest was expected to perform better than the bagging model since it randomly selects a subset of features and allows for trees to be more independent of one another. 

```{r, echo=FALSE, message=FALSE, warning=FALSE}

# Tree
tree_mse <- mean((tree_pred - test$specialTeamsSuccess)^2, na.rm = TRUE)

# Bagging
bag_mse <- mean((bag_pred - test$specialTeamsSuccess)^2, na.rm = TRUE)

# Random Forest
rf_mse <- mean((rf_pred - test$specialTeamsSuccess)^2, na.rm = TRUE)

# Table for MSE
tibble(`Method` = c("Pruned regression tree", "Bagging", "Random forest"),
       `MSE` = c(tree_mse, bag_mse, rf_mse))%>%
  kbl(caption = "Comparing MSE", align='c',  booktabs = T) %>%
  kable_styling(bootstrap_options = c("striped"), full_width = F , latex_options = "hold_position")

```

<br>
<br>
<br>

## Conclusions and Summary

Our exploratory plots inform us that overall average kick length is approximately 42 yards. We also discovered that there was no association between kick length and kicker weight or height for successful and unsuccessul kicks. Examining whether elevation is a factor in kicking length, we discovered through the Wilcoxon 2-sample t-test that there is weak evidence to support a significant difference in kick lengths between kicks performed in high altitude stadiums and kicks performed in low altitude stadiums. We also tested for a significant difference in field goal success for team home games vs. away games. However, there were no evidence suggesting a significant difference. Moreover, investigating the association between kick lengths and kick outcomes, both models that we fitted suggests that an increase in kick length is associated with a decrease in successful kick attempts. This is consistent with our exploration- which suggests that the average kick length for successful kicks is lower than the average kick length for unsuccessful kicks. A possible explanation may be because of the increasing lack of accuracy when it comes to kicking longer lengths. Finally, in  assessing whether or not a kick would be successful, coaches should place most importance on the starting yard line and also consider the game clock- as these variables were first and second respectively in importance among our ML models.

<br>

### Limitations

This report was limited to a relatively small sample size. While we were only able to examine 3 years of NFL games, ideally the report should be repeated with a dataset of field goal kicks for a decade of NFL games. Moreover, the process of finding data on players beyond basic characteristics such as age, weight and height was difficult. Being a good kicker also relies on mental factors such as how well a player is able to perform under pressure. However, these variables are difficult to quantify and hence, difficult to retrieve data for.

<br>
<br>
<br>
<br>
<br>
<br>


